"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const b=require("vue"),a=require("@tu-view-plus/utils");require("../../form/index.js");const N=require("lodash-unified"),m=require("@tu-view-plus/constants"),S=require("../../form/src/hooks/use-form-props.js"),W=require("../../form/src/hooks/use-form-item.js");function z(r,s,V){const i=b.reactive({currentValue:r.modelValue,userInput:null}),U=S.useFormSize(),f=S.useFormDisabled(),{formItem:c}=W.useFormItem(),A=b.computed(()=>a.isNumber(r.modelValue)&&r.modelValue<=r.min||f.value),_=b.computed(()=>a.isNumber(r.modelValue)&&r.modelValue>=r.max||f.value),g=b.computed(()=>{if(i.userInput!==null)return i.userInput;let e=i.currentValue;if(N.isNil(e))return"";if(a.isNumber(e)){if(Number.isNaN(e))return"";N.isUndefined(r.precision)||(e=e.toFixed(r.precision))}return e}),x=e=>{if(N.isNil(e))return 0;const n=e.toString(),t=n.indexOf(".");let u=0;return t!==-1&&(u=n.length-t-1),u},I=b.computed(()=>{const e=x(r.step);return N.isUndefined(r.precision)?Math.max(x(r.modelValue),e):(e>r.precision&&a.debugWarn("InputNumber","precision should not be less than the decimal places of step"),r.precision)}),P=(e,n)=>{if(N.isUndefined(n)&&(n=I.value),n===0)return Math.round(e);let t=String(e);const u=t.indexOf(".");if(u===-1||!t.replace(".","").split("")[u+n])return e;const E=t.length;return t.charAt(E-1)==="5"&&(t=`${t.slice(0,Math.max(0,E-1))}6`),Number.parseFloat(Number(t).toFixed(n))},D=(e,n=1)=>a.isNumber(e)?P(e+r.step*n):i.currentValue,T=(e,n)=>{const{max:t,min:u,step:d,precision:o,stepStrictly:E,valueOnClear:h}=r;t<u&&a.throwError("InputNumber","min should not be greater than max.");let l=Number(e);if(N.isNil(e)||Number.isNaN(l))return null;if(e===""){if(h===null)return null;l=N.isString(h)?{min:u,max:t}[h]:h}return E&&(l=P(Math.round(l/d)*d,o)),N.isUndefined(o)||(l=P(l,o)),(l>t||l<u)&&(l=l>t?t:u,n&&s(m.UPDATE_MODEL_EVENT,l)),l},v=(e,n=!0)=>{var d;const t=i.currentValue,u=T(e);if(!n){s(m.UPDATE_MODEL_EVENT,u);return}t!==u&&(i.userInput=null,s(m.UPDATE_MODEL_EVENT,u),s(m.CHANGE_EVENT,u,t),r.validateEvent&&((d=c==null?void 0:c.validate)==null||d.call(c,"change").catch(o=>a.debugWarn(o))),i.currentValue=u)},w=()=>{if(r.readonly||f.value||_.value)return;const e=Number(g.value)||0,n=D(e);v(n),s(m.INPUT_EVENT,i.currentValue)},F=()=>{if(r.readonly||f.value||A.value)return;const e=Number(g.value)||0,n=D(e,-1);v(n),s(m.INPUT_EVENT,i.currentValue)},M=()=>{var e,n;(n=(e=V.value)==null?void 0:e.focus)==null||n.call(e)},O=()=>{var e,n;(n=(e=V.value)==null?void 0:e.blur)==null||n.call(e)},q=e=>{s("focus",e)},y=e=>{var n;s("blur",e),r.validateEvent&&((n=c==null?void 0:c.validate)==null||n.call(c,"blur").catch(t=>a.debugWarn(t)))},C=e=>{i.userInput=e;const n=e===""?null:Number(e);s(m.INPUT_EVENT,n),v(n,!1)},L=e=>{const n=e!==""?Number(e):"";(a.isNumber(n)&&!Number.isNaN(n)||e==="")&&v(n),i.userInput=null};return b.watch(()=>r.modelValue,e=>{const n=T(i.userInput),t=T(e,!0);!a.isNumber(n)&&(!n||n!==t)&&(i.currentValue=t,i.userInput=null)},{immediate:!0}),b.onMounted(()=>{var d;const{min:e,max:n,modelValue:t}=r,u=(d=V.value)==null?void 0:d.input;if(u.setAttribute("role","spinbutton"),Number.isFinite(n)?u.setAttribute("aria-valuemax",String(n)):u.removeAttribute("aria-valuemax"),Number.isFinite(e)?u.setAttribute("aria-valuemin",String(e)):u.removeAttribute("aria-valuemin"),u.setAttribute("aria-valuenow",String(i.currentValue)),u.setAttribute("aria-disabled",String(f.value)),!a.isNumber(t)&&t!=null){let o=Number(t);Number.isNaN(o)&&(o=null),s(m.UPDATE_MODEL_EVENT,o)}}),b.onUpdated(()=>{var n;const e=(n=V.value)==null?void 0:n.input;e==null||e.setAttribute("aria-valuenow",`${i.currentValue}`)}),{inputNumberSize:U,inputNumberDisabled:f,minDisabled:A,maxDisabled:_,displayValue:g,handleIncrease:w,handleDecrease:F,handleFocus:q,handleBlur:y,handleInput:C,handleChange:L,focus:M,blur:O}}exports.default=z;
