"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),_=require("@vueuse/core"),k=require("./scrollbar.js"),B=require("@tu-view-plus/hooks"),o=require("@tu-view-plus/utils"),v=require("./util.js"),E=require("./constants.js"),P=require("./bar.vue.js");require("../style/scrollbar.css");const M=e.defineComponent({name:"TuScrollbar"}),A=e.defineComponent({...M,props:k.scrollbarProps,emits:k.scrollbarEmits,setup(T,{expose:C,emit:z}){const r=T;let i,n;const c=B.useNamespace("scrollbar"),p=e.ref(),l=e.ref(),q=e.ref(),b=e.ref("0"),w=e.ref("0"),d=e.ref(),y=e.ref(1),g=e.ref(1),x=e.computed(()=>[r.wrapClass,c.e("wrap"),{[c.em("wrap","hidden-default")]:!r.native}]),H=e.computed(()=>{const t={};return r.height&&(t.height=o.addUnit(r.height)),r.maxHeight&&(t.maxHeight=o.addUnit(r.maxHeight)),[r.wrapStyle,t]}),S=()=>{var t;l.value&&((t=d.value)==null||t.handleScroll(l.value),z("scroll",{scrollTop:l.value.scrollTop,scrollLeft:l.value.scrollLeft}))};function N(t,a){o.isObject(t)?l.value.scrollTo(t):o.isNumber(t)&&o.isNumber(a)&&l.value.scrollTo(t,a)}const R=t=>{if(!o.isNumber(t)){o.debugWarn("TuSrollbar","value must be a number");return}l.value.scrollTop=t},W=t=>{if(!o.isNumber(t)){o.debugWarn("TuSrollbar","value must be a number");return}l.value.scrollLeft=t},s=()=>{if(!l.value)return;const t=l.value.offsetHeight-v.GAP,a=l.value.offsetWidth-v.GAP,h=t**2/l.value.scrollHeight,m=a**2/l.value.scrollWidth,u=Math.max(h,r.minSize),f=Math.max(m,r.minSize);y.value=h/(t-h)/(u/(t-u)),g.value=m/(a-m)/(f/(a-f)),w.value=u+v.GAP<t?`${u}px`:"",b.value=f+v.GAP<a?`${f}px`:""};return e.provide(E.scrollbarContextKey,e.reactive({scrollbarElement:p,wrapElement:l})),e.watch(()=>r.noresize,t=>{t?(i==null||i(),n==null||n()):({stop:i}=_.useResizeObserver(q,s),n=_.useEventListener("resize",s))},{immediate:!0}),e.watch(()=>[r.maxHeight,r.height],()=>{r.native||e.nextTick(()=>{var t;s(),l.value&&((t=d.value)==null||t.handleScroll(l.value))})}),e.onMounted(async()=>{r.native||(await e.nextTick(),s())}),e.onUpdated(()=>s()),C({wrapRef:l,update:s,scrollTo:N,setScrollTop:R,setScrollLeft:W,handleScroll:S}),(t,a)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"scrollbarRef",ref:p,class:e.normalizeClass(e.unref(c).b())},[e.createElementVNode("div",{ref_key:"wrapRef",ref:l,class:e.normalizeClass(e.unref(x)),style:e.normalizeStyle(e.unref(H)),onScroll:S},[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.tag),{ref:"viewRef",class:e.normalizeClass([e.unref(c).e("view"),t.viewClass]),style:e.normalizeStyle(t.viewStyle)},{default:e.withCtx(()=>[e.renderSlot(t.$slots,"default")]),_:3},8,["class","style"])),t.native?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(P.default,{key:0,ref_key:"barRef",ref:d,height:w.value,width:b.value,always:t.always,"ratio-x":g.value,"ratio-y":y.value},null,8,["height","width","always","ratio-x","ratio-y"]))],38)],2))}});exports.default=A;
